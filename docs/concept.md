# 게임 컨셉 및 현재 작업 정리

## 컨셉

- **장르**: 고정 시점 3D 미로 퍼즐
- **핵심 메커닉**: 플레이어가 선택한 색과 연계된 경로 인지/진행
- **목표**: Start(흰색)에서 Goal(회색)까지 도달

## 현재 플레이 루프

1. 랜덤 미로 생성 후 타일에 색 그룹 배정
2. 플레이어가 방향을 전환
3. 선택 색/조건에 맞으면 자동 전진
4. 시야각 내 타일만 점진적으로 보이도록 페이드
5. 목표 지점 도달 시 클리어

## 구현된 시스템

### 1) 미로/레벨

- DFS 기반 통로 생성
- 시작/도착 타일 지정
- 타일 상판 + 하단 기둥(깊이감 연출)
- 타일별 색상 데이터(`colorMap`) 관리

### 2) 플레이어

- 그리드 좌표 기반 상태 관리
- 방향(4방향) 회전
- 보간 이동(ease-in-out)
- 색상 변경 시 머티리얼 컬러 애니메이션

### 3) 가시성/연출

- 현재 바라보는 방향 + 시야각 슬라이더 기반 가시성 계산
- 타일/기둥 opacity 목표값을 매 프레임 보간
- 전방 1칸 하이라이트 표시

### 4) 입력/UI

- 키보드: WASD(방향), 1/2/3(색), R(재시작)
- 버튼: 색상 버튼, 방향 버튼
- 슬라이더: 이동 속도, 시야각
- 클리어 토스트 표시

## 점검 결과(문제점)

### 수정 완료

- **재시작 키(R) 잠금 이슈**: 기존에는 이동 중/클리어 상태의 잠금(`isLocked`)에 걸리면 R이 무시될 수 있었음.
- **조치**: `R` 키는 잠금 검사 전에 처리하도록 입력 로직을 수정함.

### 현재 남은 개선 포인트

- 전방 하이라이트 탐색이 배열 선형 탐색이라 맵 확장 시 비효율 가능
- 클리어 직후 하이라이트 제거 타이밍을 명시적으로 처리하면 UX가 더 명확해짐
- 자동 전진 규칙: 이동 중이 아니고 클리어 전이며 이동 간격이 충족되었을 때, 전방 타일이 보행 가능이고 타일 색이 선택 색 또는 회색(goal)이면 자동 전진

## 다음 작업 제안

1. 타일 조회용 인덱스(Map) 도입으로 하이라이트 조회 최적화
2. 클리어 시 상태 일괄 정리(하이라이트/입력/카메라 연출)
3. 스테이지 고정 시드 옵션 추가(재현 가능한 테스트용)
4. 최소 smoke 테스트 스크립트(모듈 로드 + 핵심 함수 체크) 마련
